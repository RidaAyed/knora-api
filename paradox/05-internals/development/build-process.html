<!DOCTYPE html>
<html lang="en" class="no-js">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta http-equiv="x-ua-compatible" content="ie=edge">
<meta name="description" content="docs">
<meta name="generator" content="Paradox, paradox-material-theme=0.4.0, mkdocs-material=2.2.2">

<meta name="lang:clipboard.copy" content="Copy to clipboard">
<meta name="lang:clipboard.copied" content="Copied to clipboard">
<meta name="lang:search.result.none" content="No matching documents">
<meta name="lang:search.result.one" content="1 matching document">
<meta name="lang:search.result.other" content="# matching documents">
<meta name="lang:search.language" content="">
<meta name="lang:search.tokenizer" content="[\s\-]+">


<meta name="description" content="docs">
<link rel="shortcut icon" href="../../cloud">
<title>Build Process · Knora Documentation</title>
<link rel="stylesheet" href="../../assets/stylesheets/application.7a4cdee3.css">
<link rel="stylesheet" href="../../assets/stylesheets/application-palette.792431c1.css">
<link rel="stylesheet" href="../../lib/material__tabs/dist/mdc.tabs.min.css">
<link rel="stylesheet" href="../../lib/prettify/prettify.css">
<script src="../../lib/modernizr/modernizr.min.js"></script>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
<style>
body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}
code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}
</style>
<link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<link rel="stylesheet" href="../../assets/stylesheets/paradox-material-theme.css">
</head>
<body
data-md-color-primary="blue"
data-md-color-accent="yellow"
>
<input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="drawer">
<input class="md-toggle" data-md-toggle="search" type="checkbox" id="search">
<label class="md-overlay" data-md-component="overlay" for="drawer"></label>
<header class="md-header" data-md-component="header">
<nav class="md-header-nav md-grid">
<div class="md-flex">
<div class="md-flex__cell md-flex__cell--shrink">
<a href="../../index.html" title="Knora Documentation" class="md-header-nav__button md-logo">
<i class="md-icon">cloud</i>
</a>
</div>
<div class="md-flex__cell md-flex__cell--shrink">
<label class="md-icon md-icon--menu md-header-nav__button" for="drawer"></label>
</div>
<div class="md-flex__cell md-flex__cell--stretch">
<div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
<span class="md-header-nav__topic">
Knora Documentation
</span>
<span class="md-header-nav__topic">
Build Process
</span>
</div>
</div>
<div class="md-flex__cell md-flex__cell--shrink">
<label class="md-icon md-icon--search md-header-nav__button" for="search"></label>
<div class="md-search" data-md-component="search" role="dialog">
<label class="md-search__overlay" for="search"></label>
<div class="md-search__inner">
<form class="md-search__form" name="search">
<input type="text" class="md-search__input" name="query" required placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query">
<label class="md-icon md-search__icon" for="search"></label>
<button type="reset" class="md-icon md-search__icon" data-md-component="reset">&#xE5CD;</button>
</form>
<div class="md-search__output">
<div class="md-search__scrollwrap" data-md-scrollfix>
<div class="md-search-result" data-md-component="result">
<div class="md-search-result__meta">
Type to start searching
</div>
<ol class="md-search-result__list"></ol>
</div>
</div>
</div>
</div>
</div>

</div>
<div class="md-flex__cell md-flex__cell--shrink">
<div class="md-header-nav__source">
<a href="https://github.com/dhlab-basel/Knora/docs"
title="Go to repository"
class="md-source"
data-md-source="github">
<div class="md-source__icon">
<i class="fa fa-github"></i>
</div>
<div class="md-source__repository">
dhlab-basel/Knora/docs
</div>
</a>

</div>
</div>
</div>
</nav>
</header>

<div class="md-container">
<main class="md-main">
<div class="md-main__inner md-grid" data-md-component="container">
<div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav class="md-nav md-nav--primary" data-md-level="0" style="visibility: hidden">
<label class="md-nav__title md-nav__title--site" for="drawer">
<span class="md-nav__button md-logo">
<i class="md-icon">cloud</i>
</span>
<a href="../../index.html" title="Knora Documentation">
Knora Documentation
</a>
</label>
<div class="md-nav__source">
<a href="https://github.com/dhlab-basel/Knora/docs"
title="Go to repository"
class="md-source"
data-md-source="github">
<div class="md-source__icon">
<i class="fa fa-github"></i>
</div>
<div class="md-source__repository">
dhlab-basel/Knora/docs
</div>
</a>

</div>
<ul>
  <li><a href="../../01-introduction/index.html" class="page">Introduction</a>
  <ul>
    <li><a href="../../01-introduction/what-is-knora.html" class="page">What Is Knora?</a></li>
    <li><a href="../../01-introduction/data-formats.html" class="page">Data Formats in Knora</a></li>
    <li><a href="../../01-introduction/standoff-rdf.html" class="page">Standoff/RDF Text Markup</a></li>
    <li><a href="../../01-introduction/example-project.html" class="page">An Example Project</a></li>
  </ul></li>
  <li><a href="../../02-knora-ontologies/index.html" class="page">Knora Ontologies</a>
  <ul>
    <li><a href="../../02-knora-ontologies/introduction.html" class="page">Introduction</a></li>
    <li><a href="../../02-knora-ontologies/knora-base.html" class="page">The Knora Base Ontology</a></li>
    <li><a href="../../02-knora-ontologies/salsah-gui.html" class="page">The SALSAH GUI Ontology</a></li>
  </ul></li>
  <li><a href="../../03-apis/index.html" class="page">The Knora APIs</a>
  <ul>
    <li><a href="../../03-apis/api-v1/index.html" class="page">Knora API v1</a></li>
    <li><a href="../../03-apis/api-v2/index.html" class="page">Knora API v2</a></li>
    <li><a href="../../03-apis/api-admin/index.html" class="page">Knora Admin API</a></li>
  </ul></li>
  <li><a href="../../04-publishing-deployment/index.html" class="page">Deploying Knora</a>
  <ul>
    <li><a href="../../04-publishing-deployment/publishing.html" class="page">Publishing</a></li>
    <li><a href="../../04-publishing-deployment/getting-started.html" class="page">Getting Started with Knora</a></li>
    <li><a href="../../04-publishing-deployment/configuration.html" class="page">Configuration</a></li>
    <li><a href="../../04-publishing-deployment/updates.html" class="page">Updating Repositories When Upgrading Knora</a></li>
  </ul></li>
  <li><a href="../../05-internals/index.html" class="page">Knora Internals</a>
  <ul>
    <li><a href="../../05-internals/design/index.html" class="page">Design</a></li>
    <li><a href="../../05-internals/development/index.html" class="page">Development</a></li>
  </ul></li>
  <li><a href="../../06-salsah/index.html" class="page">The SALSAH 1 GUI</a></li>
  <li><a href="../../07-sipi/index.html" class="page">The Sipi Media Server</a>
  <ul>
    <li><a href="../../07-sipi/setup-sipi-for-knora.html" class="page">Setting Up Sipi for Knora</a></li>
    <li><a href="../../07-sipi/sipi-and-knora.html" class="page">Interaction Between Sipi and Knora</a></li>
  </ul></li>
  <li><a href="../../08-lucene/index.html" class="page">Lucene</a>
  <ul>
    <li><a href="../../08-lucene/lucene-query-parser-syntax.html" class="page">Lucene Query Parser Syntax</a></li>
  </ul></li>
  <li><a href="../../faq.html" class="page">Frequently Asked Questions</a></li>
  <li><a href="../../00-release-notes/index.html" class="page">Release Notes</a>
  <ul>
    <li><a href="../../00-release-notes/v1.1.0.html" class="page">v1.1.0 Release Notes</a></li>
    <li><a href="../../00-release-notes/v1.2.0.html" class="page">v1.2.0 Release Notes</a></li>
    <li><a href="../../00-release-notes/v1.3.0.html" class="page">v1.3.0 Release Notes</a></li>
    <li><a href="../../00-release-notes/v1.4.0.html" class="page">v1.4.0 Release Notes</a></li>
    <li><a href="../../00-release-notes/v1.5.0.html" class="page">v1.5.0 Release Notes</a></li>
    <li><a href="../../00-release-notes/v1.6.0.html" class="page">v1.6.0 Release Notes</a></li>
    <li><a href="../../00-release-notes/v1.7.0.html" class="page">v1.7.x Release Notes</a></li>
    <li><a href="../../00-release-notes/v2.x.x.html" class="page">v2.x.x Release Notes</a></li>
    <li><a href="../../00-release-notes/v3.x.x.html" class="page">v3.x.x Release Notes</a></li>
    <li><a href="../../00-release-notes/v4.x.x.html" class="page">v4.x.x Release Notes</a></li>
    <li><a href="../../00-release-notes/v5.x.x.html" class="page">v5.x.x Release Notes</a></li>
    <li><a href="../../00-release-notes/v6.x.x.html" class="page">v6.x.x Release Notes</a></li>
    <li><a href="../../00-release-notes/next.html" class="page">Release Notes for Next Release</a></li>
    <li><a href="../../00-release-notes/migration.html" class="page">Migration Notes</a></li>
  </ul></li>
</ul>
<nav class="md-nav md-nav--secondary">
<label class="md-nav__title" for="toc">Table of contents</label>
<ul>
  <li><a href="../../05-internals/development/build-process.html#build-process" class="header">Build Process</a>
  <ul>
    <li><a href="../../05-internals/development/build-process.html#sbt-build-configuration" class="header">SBT Build Configuration</a></li>
    <li><a href="../../05-internals/development/build-process.html#building-deployment-packages" class="header">Building Deployment Packages</a></li>
    <li><a href="../../05-internals/development/build-process.html#building-docker-images" class="header">Building Docker Images</a></li>
    <li><a href="../../05-internals/development/build-process.html#running-the-knora-stack-graphdb-webapi-salsah1-sipi-" class="header">Running the Knora Stack (graphdb, webapi, salsah1, sipi)</a></li>
    <li><a href="../../05-internals/development/build-process.html#building-documentation" class="header">Building Documentation</a></li>
    <li><a href="../../05-internals/development/build-process.html#publishing-documentation" class="header">Publishing Documentation</a></li>
  </ul></li>
</ul>
</nav>

<div class="md-nav__title--site md-version" title="Version">
<i class="md-icon">label_outline</i> 10.0.0
</div>
</nav>

</div>
</div>
</div>
<div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav class="md-nav md-nav--secondary">
<label class="md-nav__title" for="toc">Table of contents</label>
<ul>
  <li><a href="../../05-internals/development/build-process.html#build-process" class="header">Build Process</a>
  <ul>
    <li><a href="../../05-internals/development/build-process.html#sbt-build-configuration" class="header">SBT Build Configuration</a></li>
    <li><a href="../../05-internals/development/build-process.html#building-deployment-packages" class="header">Building Deployment Packages</a></li>
    <li><a href="../../05-internals/development/build-process.html#building-docker-images" class="header">Building Docker Images</a></li>
    <li><a href="../../05-internals/development/build-process.html#running-the-knora-stack-graphdb-webapi-salsah1-sipi-" class="header">Running the Knora Stack (graphdb, webapi, salsah1, sipi)</a></li>
    <li><a href="../../05-internals/development/build-process.html#building-documentation" class="header">Building Documentation</a></li>
    <li><a href="../../05-internals/development/build-process.html#publishing-documentation" class="header">Publishing Documentation</a></li>
  </ul></li>
</ul>
</nav>

</div>
</div>
</div>
<div class="md-content">
<article class="md-content__inner md-typeset">
<div class="md-content__searchable">
<!---
Copyright © 2015-2019 the contributors (see Contributors.md).

This file is part of Knora.

Knora is free software: you can redistribute it and/or modify
it under the terms of the GNU Affero General Public License as published
by the Free Software Foundation, either version 3 of the License, or
(at your option) any later version.

Knora is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU Affero General Public License for more details.

You should have received a copy of the GNU Affero General Public
License along with Knora.  If not, see <http://www.gnu.org/licenses/>.
-->
<h1><a href="#build-process" name="build-process" class="anchor"><span class="anchor-link"></span></a>Build Process</h1>
<div class="toc ">
<ul>
  <li><a href="../../05-internals/development/build-process.html#sbt-build-configuration" class="header">SBT Build Configuration</a></li>
  <li><a href="../../05-internals/development/build-process.html#building-deployment-packages" class="header">Building Deployment Packages</a></li>
  <li><a href="../../05-internals/development/build-process.html#building-docker-images" class="header">Building Docker Images</a></li>
  <li><a href="../../05-internals/development/build-process.html#running-the-knora-stack-graphdb-webapi-salsah1-sipi-" class="header">Running the Knora Stack (graphdb, webapi, salsah1, sipi)</a></li>
  <li><a href="../../05-internals/development/build-process.html#building-documentation" class="header">Building Documentation</a></li>
  <li><a href="../../05-internals/development/build-process.html#publishing-documentation" class="header">Publishing Documentation</a></li>
</ul>
</div>
<h2><a href="#sbt-build-configuration" name="sbt-build-configuration" class="anchor"><span class="anchor-link"></span></a>SBT Build Configuration</h2>
<p>Knora&rsquo;s complete build definition is defined in <code>KnoraBuild.sbt</code>:</p>
<pre class="prettyprint"><code class="language-sbt"><br/>import com.typesafe.sbt.SbtNativePackager.autoImport.NativePackagerHelper._
import com.typesafe.sbt.packager.docker.DockerPlugin.autoImport.{Docker, dockerRepository}
import com.typesafe.sbt.packager.docker.{Cmd, ExecCmd}
import org.knora.Dependencies
import sbt.Keys.version

import scala.sys.process.Process

//////////////////////////////////////
// GLOBAL SETTINGS
//////////////////////////////////////

// custom docker-compose plugin settings
lazy val GDB = config(&quot;gdb&quot;) extend Default

lazy val GDBSIPI = config(&quot;gdbsipi&quot;) extend Default

lazy val aggregatedProjects: Seq[ProjectReference] = Seq(docs, salsah1, webapi, knoraGraphDbSe, knoraGraphdbFree, knoraSipi, knoraAssets)

lazy val buildSettings = Dependencies.Versions ++ Seq(
    organization := &quot;org.knora&quot;,
    version := (ThisBuild / version).value
)

lazy val rootBaseDir = baseDirectory.in(ThisBuild)

lazy val root: Project = Project(id = &quot;knora&quot;, file(&quot;.&quot;))
  .aggregate(aggregatedProjects: _*)
  .enablePlugins(DockerComposePlugin, GitVersioning, GitBranchPrompt)
  .settings(Dependencies.Versions)
  .settings(
      // values set for all sub-projects
      // These are normal sbt settings to configure for release, skip if already defined

      ThisBuild / licenses := Seq(&quot;AGPL-3.0&quot; -&gt; url(&quot;https://opensource.org/licenses/AGPL-3.0&quot;)),
      ThisBuild / homepage := Some(url(&quot;https://github.com/dhlab-basel/Knora&quot;)),
      ThisBuild / scmInfo := Some(ScmInfo(url(&quot;https://github.com/dhlab-basel/Knora&quot;), &quot;scm:git:git@github.com:dhlab-basel/Knora.git&quot;)),

      // use &#39;git describe&#39; for deriving the version
      git.useGitDescribe := true,

      // override generated version string because docker hub rejects &#39;+&#39; in tags
      ThisBuild / version ~= (_.replace(&#39;+&#39;, &#39;-&#39;)),

      // use Ctrl-c to stop current task but not quit SBT
      Global / cancelable := true,

      publish / skip := true,

      Dependencies.sysProps := sys.props.toString(),
      Dependencies.sysEnvs := sys.env.toString(),

      // these can be set by the user as system environment variables
      ThisBuild / Dependencies.gdbHomePath := sys.env.getOrElse(&quot;KNORA_GDB_HOME&quot;, sys.props(&quot;user.dir&quot;) + &quot;/triplestores/graphdb/home&quot;),
      ThisBuild / Dependencies.gdbLicensePath := sys.env.getOrElse(&quot;KNORA_GDB_LICENSE&quot;, sys.props(&quot;user.dir&quot;) + &quot;/triplestores/graphdb/graphdb.license&quot;),

      // these are calculated in their respective targets
      Dependencies.knoraSipiImage := &quot;dhlabbasel/knora-sipi:&quot; + version.value,
      Dependencies.knoraGdbImage := {
          if (Dependencies.gdbTypeString.equals(&quot;graphdb-free&quot;)) {
              &quot;dhlabbasel/knora-graphdb-free:&quot; + version.value
          } else {
              &quot;dhlabbasel/knora-graphdb-se:&quot; + version.value
          }
      },
      Dependencies.knoraWebapiImage := &quot;dhlabbasel/webapi:&quot; + version.value,
      Dependencies.knoraSalsah1Image := &quot;dhlabbasel/salsah1:&quot; + version.value,

      // use these values for variable substitution in the docker-compose.yml
      variablesForSubstitution := Map(
          &quot;KNORA_GDB_HOME&quot; -&gt; Dependencies.gdbHomePath.value,
          &quot;KNORA_GDB_LICENSE&quot; -&gt; Dependencies.gdbLicensePath.value,
          &quot;KNORA_GDB_TYPE&quot; -&gt; Dependencies.gdbTypeString,
          &quot;KNORA_GDB_IMAGE&quot; -&gt; Dependencies.knoraGdbImage.value,
          &quot;KNORA_SIPI_IMAGE&quot; -&gt; Dependencies.knoraSipiImage.value,
          &quot;KNORA_WEBAPI_IMAGE&quot; -&gt; Dependencies.knoraWebapiImage.value,
          &quot;KNORA_SALSAH1_IMAGE&quot; -&gt; Dependencies.knoraSalsah1Image.value
      ),

      dockerImageCreationTask := Seq(
          (salsah1 / Docker / publishLocal).value,
          (webapi / Docker / publishLocal).value,
          (knoraGraphDbSe / Docker / publishLocal).value,
          (knoraGraphdbFree / Docker / publishLocal).value,
          (knoraSipi / Docker / publishLocal).value
      )
  )


//////////////////////////////////////
// DOCS (./docs)
//////////////////////////////////////

// Define `Configuration` instances representing our different documentation trees
lazy val ParadoxSite = config(&quot;paradox&quot;)

lazy val docs = knoraModule(&quot;docs&quot;)
        .enablePlugins(JekyllPlugin, ParadoxPlugin, ParadoxSitePlugin, ParadoxMaterialThemePlugin, GhpagesPlugin)
        .configs(
            ParadoxSite
        )
        .settings(
            // Apply default settings to our two custom configuration instances
            ParadoxSitePlugin.paradoxSettings(ParadoxSite),
            ParadoxMaterialThemePlugin.paradoxMaterialThemeGlobalSettings, // paradoxTheme and version
            ParadoxMaterialThemePlugin.paradoxMaterialThemeSettings(ParadoxSite),

            // Skip packageDoc and packageSrc task on stage
            Compile / packageDoc / mappings := Seq(),
            Compile / packageSrc / mappings := Seq(),
        )
        .settings(

            // Ghpages settings
            ghpagesNoJekyll := true,
            git.remoteRepo := &quot;git@github.com:dhlab-basel/Knora.git&quot;,
            ghpagesCleanSite / excludeFilter :=
                    new FileFilter {
                        def accept(f: File) = (ghpagesRepository.value / &quot;CNAME&quot;).getCanonicalPath == f.getCanonicalPath
                    } || &quot;LICENSE.md&quot; || &quot;README.md&quot;,

            // (sbt-site) Customize the source directory
            // sourceDirectory in Jekyll := sourceDirectory.value / &quot;overview&quot;,
            ParadoxSite / sourceDirectory := sourceDirectory.value / &quot;paradox&quot;,

            // (sbt-site) Customize the output directory (subdirectory of site)
            ParadoxSite / siteSubdirName := &quot;paradox&quot;,

            // Set some paradox properties
            ParadoxSite / paradoxProperties ++= Map(
                &quot;project.name&quot; -&gt; &quot;Knora Documentation&quot;,
                &quot;github.base_url&quot; -&gt; &quot;https://github.com/dhlab-basel/Knora&quot;,
                &quot;image.base_url&quot; -&gt; &quot;.../assets/images&quot;,
                &quot;extref.rfc.base_url&quot; -&gt; &quot;http://tools.ietf.org/html/rfc%s&quot;,
                &quot;snip.src.base_dir&quot; -&gt; ((baseDirectory in ThisBuild).value / &quot;webapi&quot; / &quot;src&quot; / &quot;main&quot; / &quot;scala&quot;).getAbsolutePath,
                &quot;snip.test.base_dir&quot; -&gt; ((baseDirectory in ThisBuild).value / &quot;webapi&quot; / &quot;src&quot; / &quot;test&quot; / &quot;scala&quot;).getAbsolutePath
            ),

            // Paradox Material Theme Settings
            ParadoxSite / paradoxMaterialTheme ~= {
                _.withColor(&quot;blue&quot;, &quot;yellow&quot;)
                        .withRepository(uri(&quot;https://github.com/dhlab-basel/Knora/docs&quot;))
                        .withFavicon(&quot;cloud&quot;)
                        .withLogoIcon(&quot;cloud&quot;)
                        .withSocial(
                            uri(&quot;https://github.com/dhlab-basel&quot;),
                            uri(&quot;https://twitter.com/dhlabbasel&quot;)
                        )
                        .withLanguage(java.util.Locale.ENGLISH)
                        .withCopyright(&quot;Copyright 2015-2019 the contributors (see Contributors.md)&quot;)
            },
            makeSite / mappings ++= Seq(
                file(&quot;docs/src/api-admin/index.html&quot;) -&gt; &quot;api-admin/index.html&quot;,
                file(&quot;docs/src/api-admin/swagger.json&quot;) -&gt; &quot;api-admin/swagger.json&quot;
            ),
            makeSite := makeSite.dependsOn(buildPrequisites).value
        )

lazy val buildPrequisites = taskKey[Unit](&quot;Build typescript API documentation and Graphviz diagrams.&quot;)

docs / buildPrequisites := {
    val s: TaskStreams = streams.value

    val execDir: Option[File] = if (sys.props(&quot;user.dir&quot;).endsWith(&quot;docs&quot;)) {
        // running from docs directory, which is fine
        None
    } else {
        // running from project root directory
        Some(new File(sys.props(&quot;user.dir&quot;) + &quot;/docs&quot;))
    }

    val shell: Seq[String] = if (sys.props(&quot;os.name&quot;).contains(&quot;Windows&quot;)) Seq(&quot;cmd&quot;, &quot;/c&quot;) else Seq(&quot;bash&quot;, &quot;-c&quot;)
    val clean: Seq[String] = shell :+ &quot;make clean&quot;
    val jsonformat: Seq[String] = shell :+ &quot;make jsonformat&quot;
    val graphvizfigures: Seq[String] = shell :+ &quot;make graphvizfigures&quot;
    val jsonformattest: Seq[String] = shell :+ &quot;make jsonformattest&quot;

    s.log.info(&quot;building typescript documentation and graphviz diagrams...&quot;)

    if ((Process(clean, execDir) #&amp;&amp; Process(jsonformattest, execDir) #&amp;&amp; Process(jsonformat, execDir) #&amp;&amp; Process(graphvizfigures, execDir) !) == 0) {
        Thread.sleep(500)
        s.log.success(&quot;typescript documentation and graphviz diagrams built successfully&quot;)
    } else {
        throw new IllegalStateException(&quot;typescript documentation and graphviz diagrams failed to build&quot;)
    }
}


//////////////////////////////////////
// Knora&#39;s custom GraphDB-SE
//////////////////////////////////////

lazy val graphdbseCommonSettings = Seq(
    name := &quot;knora-graphdb-se&quot;
)

lazy val knoraGraphDbSe: Project = knoraModule(&quot;knora-graphdb-se&quot;)
  .enablePlugins(DockerPlugin)
  .settings(
      graphdbseCommonSettings
  )
  .settings( // enable deployment staging with `sbt stage`
      // Skip packageDoc and packageSrc task on stage
      Compile / packageDoc / mappings := Seq(),
      Compile / packageSrc / mappings := Seq(),
      Universal / mappings ++= {
          // copy the webapi/scripts folder
          directory(&quot;webapi/scripts&quot;)
      },

      // add dockerCommands used to create the image
      // docker:stage, docker:publishLocal, docker:publish, docker:clean

      dockerRepository := Some(&quot;dhlabbasel&quot;),

      maintainer := &quot;400790+subotic@users.noreply.github.com&quot;,

      Docker / dockerExposedPorts ++= Seq(7200),
      Docker / dockerCommands := Seq(
          // FIXME: Someday find out how to reference here Dependencies.Versions.gdbSEImage
          Cmd(&quot;FROM&quot;, &quot;ontotext/graphdb:8.5.0-se&quot;),
          Cmd(&quot;LABEL&quot;, s&quot;&quot;&quot;MAINTAINER=&quot;${maintainer.value}&quot;&quot;&quot;&quot;),
          Cmd(&quot;COPY&quot;, &quot;opt/docker/scripts&quot;, &quot;/scripts&quot;),
          Cmd(&quot;RUN&quot;, &quot;mkdir -p /graphdb &amp;&amp; cp /scripts/KnoraRules.pie /graphdb/KnoraRules.pie &amp;&amp; rm -rf /scripts&quot;),
      )
  )

//////////////////////////////////////
// Knora&#39;s custom GraphDB-Free
//////////////////////////////////////

lazy val graphdbfreeCommonSettings = Seq(
    name := &quot;knora-graphdb-free&quot;
)

lazy val knoraGraphdbFree: Project = knoraModule(&quot;knora-graphdb-free&quot;)
  .enablePlugins(DockerPlugin)
  .settings(
      graphdbfreeCommonSettings
  )
  .settings(
      // Skip packageDoc and packageSrc task on stage
      Compile / packageDoc / mappings := Seq(),
      Compile / packageSrc / mappings := Seq(),
      Universal / mappings ++= {
          // copy the webapi/scripts folder
          directory(&quot;webapi/scripts&quot;)
      },

      // add dockerCommands used to create the image
      // docker:stage, docker:publishLocal, docker:publish, docker:clean

      dockerRepository := Some(&quot;dhlabbasel&quot;),

      maintainer := &quot;400790+subotic@users.noreply.github.com&quot;,

      Docker / dockerExposedPorts ++= Seq(7200),
      Docker / dockerCommands := Seq(
          // FIXME: Someday find out how to reference here Dependencies.Versions.gdbFreeImage
          Cmd(&quot;FROM&quot;, &quot;dhlabbasel/graphdb:8.10.0-free&quot;),
          Cmd(&quot;LABEL&quot;, s&quot;&quot;&quot;MAINTAINER=&quot;${maintainer.value}&quot;&quot;&quot;&quot;),
          Cmd(&quot;COPY&quot;, &quot;opt/docker/scripts&quot;, &quot;/scripts&quot;),
          Cmd(&quot;RUN&quot;, &quot;mkdir -p /graphdb &amp;&amp; cp /scripts/KnoraRules.pie /graphdb/KnoraRules.pie &amp;&amp; rm -rf /scripts&quot;),
      )
  )

//////////////////////////////////////
// Knora&#39;s custom Sipi
//////////////////////////////////////

lazy val knoraSipiCommonSettings = Seq(
    name := &quot;knora-sipi&quot;
)

lazy val knoraSipi: Project = knoraModule(&quot;knora-sipi&quot;)
  .enablePlugins(DockerPlugin)
  .settings(
      knoraSipiCommonSettings
  )
  .settings(
      // Skip packageDoc and packageSrc task on stage
      Compile / packageDoc / mappings := Seq(),
      Compile / packageSrc / mappings := Seq(),
      Universal / mappings ++= {
          // copy the sipi/scripts folder
          directory(&quot;sipi/scripts&quot;)
      },

      // add dockerCommands used to create the image
      // docker:stage, docker:publishLocal, docker:publish, docker:clean

      dockerRepository := Some(&quot;dhlabbasel&quot;),

      maintainer := &quot;400790+subotic@users.noreply.github.com&quot;,

      Docker / dockerExposedPorts ++= Seq(1024),
      Docker / dockerCommands := Seq(
          // FIXME: Someday find out how to reference here Dependencies.Versions.sipiImage
          Cmd(&quot;FROM&quot;, &quot;dhlabbasel/sipi:v2.0.1&quot;),
          Cmd(&quot;LABEL&quot;, s&quot;&quot;&quot;MAINTAINER=&quot;${maintainer.value}&quot;&quot;&quot;&quot;),
          Cmd(&quot;COPY&quot;, &quot;opt/docker/scripts&quot;, &quot;/sipi/scripts&quot;),
      )
  )


//////////////////////////////////////
// Knora&#39;s assets
//////////////////////////////////////

lazy val knoraAssetsCommonSettings = Seq(
    name := &quot;knora-assets&quot;
)

lazy val knoraAssets: Project = knoraModule(&quot;knora-assets&quot;)
  .enablePlugins(DockerPlugin)
  .settings(
      knoraAssetsCommonSettings
  )
  .settings(
      // Skip packageDoc and packageSrc task on stage
      Compile / packageDoc / mappings := Seq(),
      Compile / packageSrc / mappings := Seq(),
      Universal / mappings ++= {
          // copy the different folders
          directory(&quot;webapi/scripts&quot;) ++
            directory(&quot;webapi/_test_data&quot;) ++
            directory(&quot;webapi/_assets&quot;) ++
            directory(&quot;knora-ontologies&quot;)
      },

      // add dockerCommands used to create the image
      // docker:stage, docker:publishLocal, docker:publish, docker:clean

      dockerRepository := Some(&quot;dhlabbasel&quot;),

      maintainer := &quot;400790+subotic@users.noreply.github.com&quot;,
      Docker / dockerExposedPorts ++= Seq(9999), // not used. added just so that there is no warning
      Docker / dockerCommands := Seq(
          Cmd(&quot;FROM&quot;, &quot;scratch&quot;),
          Cmd(&quot;LABEL&quot;, s&quot;&quot;&quot;MAINTAINER=&quot;${maintainer.value}&quot;&quot;&quot;&quot;),
          Cmd(&quot;COPY&quot;, &quot;opt/docker&quot;, &quot;/assets&quot;)
      )
  )

//////////////////////////////////////
// Knora upgrade scripts
//////////////////////////////////////

lazy val upgradeCommonSettings = Seq(
    name := &quot;upgrade&quot;
)

lazy val upgrade: Project = knoraModule(&quot;upgrade&quot;)
  .dependsOn(webapi)
  .enablePlugins(JavaAppPackaging, DockerPlugin)
  .settings(
      upgradeCommonSettings,
      Dependencies.upgradeLibraryDependencies,
      // use jars (and not class directory) for run, test, console
      exportJars := true,
      unmanagedResourceDirectories in Compile += (rootBaseDir.value / &quot;knora-ontologies&quot;),

      // add content of knora-ontologies to jar
      mappings in (Compile, packageBin) ++= Seq (
          (rootBaseDir.value / &quot;knora-ontologies&quot; / &quot;knora-admin.ttl&quot;) -&gt; &quot;knora-ontologies/knora-admin.ttl&quot;,
          (rootBaseDir.value / &quot;knora-ontologies&quot; / &quot;knora-base.ttl&quot;) -&gt; &quot;knora-ontologies/knora-base.ttl&quot;,
          (rootBaseDir.value / &quot;knora-ontologies&quot; / &quot;salsah-gui.ttl&quot;) -&gt; &quot;knora-ontologies/salsah-gui.ttl&quot;,
          (rootBaseDir.value / &quot;knora-ontologies&quot; / &quot;standoff-data.ttl&quot;) -&gt; &quot;knora-ontologies/standoff-data.ttl&quot;,
          (rootBaseDir.value / &quot;knora-ontologies&quot; / &quot;standoff-onto.ttl&quot;) -&gt; &quot;knora-ontologies/standoff-onto.ttl&quot;,
      ),
      // contentOf(&quot;salsah1/src/main/resources&quot;).toMap.mapValues(&quot;config/&quot; + _)
      // (rootBaseDir.value / &quot;knora-ontologies&quot;) -&gt; &quot;knora-ontologies&quot;,

  )
  .settings(
      scalacOptions ++= Seq(&quot;-feature&quot;, &quot;-unchecked&quot;, &quot;-deprecation&quot;, &quot;-Yresolve-term-conflict:package&quot;),
      logLevel := Level.Info,
      run / fork := true,
      run / javaOptions ++= upgradeJavaRunOptions,
      Compile / run / mainClass := Some(&quot;org.knora.upgrade.Main&quot;),
      Test / fork := true,
      Test / javaOptions ++= upgradeJavaTestOptions,
      Test / parallelExecution := false,
      /* show full stack traces and test case durations */
      Test / testOptions += Tests.Argument(&quot;-oDF&quot;),
  )
  .settings(
      // Skip packageDoc and packageSrc task on stage
      Compile / packageDoc / mappings := Seq(),
      Compile / packageSrc / mappings := Seq(),

      Universal / mappings ++= {
          // copy the different folders
          directory(&quot;upgrade/graphdb-se&quot;)
      },

      // add dockerCommands used to create the image
      // docker:stage, docker:publishLocal, docker:publish, docker:clean
      dockerRepository := Some(&quot;dhlabbasel&quot;),
      dockerUpdateLatest := true,
      maintainer := &quot;400790+subotic@users.noreply.github.com&quot;,
      Docker / dockerCommands := Seq(
          Cmd(&quot;FROM&quot;, &quot;adoptopenjdk/openjdk11:alpine-jre&quot;),
          Cmd(&quot;LABEL&quot;, s&quot;&quot;&quot;MAINTAINER=&quot;${maintainer.value}&quot;&quot;&quot;&quot;),
          Cmd(&quot;RUN apk update &amp;&amp; apk upgrade &amp;&amp; apk add bash&quot;),

          Cmd(&quot;ENV&quot;, &quot;&quot;&quot;KNORA_UPGRADE_DOCKER=&quot;true&quot;&quot;&quot;&quot;),
          Cmd(&quot;COPY&quot;, &quot;opt/docker&quot;, &quot;/upgrade&quot;),
          Cmd(&quot;WORKDIR&quot;, &quot;/upgrade/graphdb-se&quot;),
          ExecCmd(&quot;ENTRYPOINT&quot;, &quot;/upgrade/graphdb-se/auto-upgrade.sh&quot;),
      ),
  )

lazy val upgradeJavaRunOptions = Seq(
    // &quot;-showversion&quot;,
    &quot;-Xms1G&quot;,
    &quot;-Xmx1G&quot;
    // &quot;-verbose:gc&quot;,
    //&quot;-XX:+UseG1GC&quot;,
    //&quot;-XX:MaxGCPauseMillis=500&quot;,
    //&quot;-XX:MaxMetaspaceSize=4096m&quot;
)

lazy val upgradeJavaTestOptions = Seq(
    // &quot;-showversion&quot;,
    &quot;-Xms1G&quot;,
    &quot;-Xmx1G&quot;
    // &quot;-verbose:gc&quot;,
    //&quot;-XX:+UseG1GC&quot;,
    //&quot;-XX:MaxGCPauseMillis=500&quot;,
    //&quot;-XX:MaxMetaspaceSize=4096m&quot;
)

//////////////////////////////////////
// SALSAH1 (./salsah1)
//////////////////////////////////////

lazy val salsahCommonSettings = Seq(
    name := &quot;salsah1&quot;
)

lazy val salsah1: Project = knoraModule(&quot;salsah1&quot;)
  .enablePlugins(JavaAppPackaging, DockerPlugin, DockerComposePlugin)
  .configs(
      HeadlessTest
  )
  .settings(
      salsahCommonSettings,
      Revolver.settings
  )
  .settings(inConfig(HeadlessTest)(
      Defaults.testTasks ++ Seq(
          fork := true,
          javaOptions ++= javaHeadlessTestOptions,
          testOptions += Tests.Argument(&quot;-oDF&quot;) // show full stack traces and test case durations
      )
  ): _*)
  .settings(
      Dependencies.salsahLibraryDependencies,
      logLevel := Level.Info,
      run / fork := true,
      run / javaOptions ++= javaRunOptions,
      Compile / run / mainClass := Some(&quot;org.knora.salsah.Main&quot;),
      Test / fork := true,
      Test / javaOptions ++= javaTestOptions,
      Test / parallelExecution := false,
      /* show full stack traces and test case durations */
      Test / testOptions += Tests.Argument(&quot;-oDF&quot;)
  )
  .settings( // enable deployment staging with `sbt stage`
        // Skip packageDoc and packageSrc task on stage
        Compile / packageDoc / mappings := Seq(),
        Compile / packageSrc / mappings := Seq(),
      Universal / mappings ++= {
          // copy the public folder
          directory(&quot;salsah1/src/public&quot;) ++
            // copy the configuration files to config directory
            // contentOf(&quot;salsah1/configs&quot;).toMap.mapValues(&quot;config/&quot; + _) ++
            // copy configuration files to config directory
            contentOf(&quot;salsah1/src/main/resources&quot;).toMap.mapValues(&quot;config/&quot; + _)
      },
      // add &#39;config&#39; directory first in the classpath of the start script,
      scriptClasspath := Seq(&quot;../config/&quot;) ++ scriptClasspath.value,
      // need this here, but why?
      Compile / mainClass := Some(&quot;org.knora.salsah.Main&quot;),

      // add dockerCommands used to create the image
      // docker:stage, docker:publishLocal, docker:publish, docker:clean

      dockerRepository := Some(&quot;dhlabbasel&quot;),

      maintainer := &quot;400790+subotic@users.noreply.github.com&quot;,

      Docker / dockerExposedPorts ++= Seq(3335),
      Docker / dockerCommands := Seq(
          Cmd(&quot;FROM&quot;, &quot;adoptopenjdk/openjdk11:alpine-jre&quot;),
          Cmd(&quot;LABEL&quot;, s&quot;&quot;&quot;MAINTAINER=&quot;${maintainer.value}&quot;&quot;&quot;&quot;),

          Cmd(&quot;ENV&quot;, &quot;&quot;&quot;LANG=&quot;en_US.UTF-8&quot;&quot;&quot;&quot;),
          Cmd(&quot;ENV&quot;, &quot;&quot;&quot;JAVA_OPTS=&quot;-Dsun.jnu.encoding=UTF-8 -Dfile.encoding=UTF-8&quot;&quot;&quot;&quot;),
          Cmd(&quot;ENV&quot;, &quot;KNORA_SALSAH1_DEPLOYED=true&quot;),
          Cmd(&quot;ENV&quot;, &quot;KNORA_SALSAH1_WORKDIR=/salsah1&quot;),
          Cmd(&quot;RUN apk update &amp;&amp; apk upgrade &amp;&amp; apk add bash&quot;),
          Cmd(&quot;COPY&quot;, &quot;opt/docker&quot;, &quot;/salsah1&quot;),
          Cmd(&quot;WORKDIR&quot;, &quot;/salsah1&quot;),

          Cmd(&quot;EXPOSE&quot;, &quot;3335&quot;),

          ExecCmd(&quot;ENTRYPOINT&quot;, &quot;bin/salsah1&quot;),
      ),


  )

lazy val javaRunOptions = Seq(
    // &quot;-showversion&quot;,
    &quot;-Xms256m&quot;,
    &quot;-Xmx256m&quot;
    // &quot;-verbose:gc&quot;,
    //&quot;-XX:+UseG1GC&quot;,
    //&quot;-XX:MaxGCPauseMillis=500&quot;
)

lazy val javaTestOptions = Seq(
    // &quot;-showversion&quot;,
    &quot;-Xms512m&quot;,
    &quot;-Xmx512m&quot;
    // &quot;-verbose:gc&quot;,
    //&quot;-XX:+UseG1GC&quot;,
    //&quot;-XX:MaxGCPauseMillis=500&quot;,
    //&quot;-XX:MaxMetaspaceSize=4096m&quot;
)


lazy val HeadlessTest = config(&quot;headless&quot;) extend (Test)
lazy val javaHeadlessTestOptions = Seq(
    &quot;-Dconfig.resource=headless-testing.conf&quot;
) ++ javaTestOptions



//////////////////////////////////////
// WEBAPI (./webapi)
//////////////////////////////////////

import com.typesafe.sbt.SbtNativePackager.autoImport.NativePackagerHelper._
import sbt._
import sbt.librarymanagement.Resolver

connectInput in run := true

lazy val webApiCommonSettings = Seq(
    name := &quot;webapi&quot;
)

// custom test and it settings
lazy val GDBSE = config(&quot;gdbse&quot;) extend Test
lazy val GDBSEIt = config(&quot;gdbse-it&quot;) extend IntegrationTest
lazy val GDBFree = config(&quot;gdbfree&quot;) extend Test
lazy val GDBFreeIt = config(&quot;gdbfree-it&quot;) extend IntegrationTest
lazy val FusekiTest = config(&quot;fuseki&quot;) extend Test
lazy val FusekiIt = config(&quot;fuseki-it&quot;) extend IntegrationTest
lazy val EmbeddedJenaTDBTest = config(&quot;tdb&quot;) extend Test

// GatlingPlugin - load testing
// JavaAgent - adds AspectJ Weaver configuration
// BuildInfoPlugin - allows generation of scala code with version information

lazy val webapi = knoraModule(&quot;webapi&quot;)
        .enablePlugins(SbtTwirl, JavaAppPackaging, DockerPlugin, GatlingPlugin, JavaAgent, RevolverPlugin, BuildInfoPlugin)
        .configs(
            IntegrationTest,
            Gatling,
            GatlingIt,
            GDBSE,
            GDBSEIt,
            GDBFree,
            GDBFreeIt,
            FusekiTest,
            FusekiIt,
            EmbeddedJenaTDBTest
        )
        .settings(
            webApiCommonSettings,
            resolvers ++= Seq(
                Resolver.bintrayRepo(&quot;hseeberger&quot;, &quot;maven&quot;)
            ),
            Dependencies.webapiLibraryDependencies
        )
        .settings(
            inConfig(Test)(Defaults.testTasks ++ baseAssemblySettings),
            inConfig(IntegrationTest)(Defaults.testSettings),
            inConfig(Gatling)(Defaults.testTasks ++ Seq(forkOptions := Defaults.forkOptionsTask.value)),
            inConfig(GatlingIt)(Defaults.testTasks ++ Seq(forkOptions := Defaults.forkOptionsTask.value)),
            inConfig(GDBSE)(Defaults.testTasks ++ Seq(forkOptions := Defaults.forkOptionsTask.value)),
            inConfig(GDBSEIt)(Defaults.testTasks ++ Seq(forkOptions := Defaults.forkOptionsTask.value)),
            inConfig(GDBFree)(Defaults.testTasks ++ Seq(forkOptions := Defaults.forkOptionsTask.value)),
            inConfig(GDBFreeIt)(Defaults.testTasks ++ Seq(forkOptions := Defaults.forkOptionsTask.value)),
            inConfig(FusekiTest)(Defaults.testTasks ++ Seq(forkOptions := Defaults.forkOptionsTask.value)),
            inConfig(FusekiIt)(Defaults.testTasks ++ Seq(forkOptions := Defaults.forkOptionsTask.value)),
            inConfig(EmbeddedJenaTDBTest)(Defaults.testTasks ++ Seq(forkOptions := Defaults.forkOptionsTask.value))
        )
        .settings(
            scalacOptions ++= Seq(&quot;-feature&quot;, &quot;-unchecked&quot;, &quot;-deprecation&quot;, &quot;-Yresolve-term-conflict:package&quot;),

            logLevel := Level.Info,

            fork := true, // always fork

            run / javaOptions := webapiJavaRunOptions,

            reStart / javaOptions ++= resolvedJavaAgents.value map { resolved =&gt;
                &quot;-javaagent:&quot; + resolved.artifact.absolutePath + resolved.agent.arguments
            }, // allows sbt-javaagent to work with sbt-revolver
            reStart / javaOptions ++= webapiJavaRunOptions,

            javaAgents += Dependencies.Compile.aspectJWeaver,

            Test / parallelExecution := false,
            Test / javaOptions ++= Seq(&quot;-Dconfig.resource=graphdb-se.conf&quot;) ++ webapiJavaTestOptions,
            // Test / javaOptions ++= Seq(&quot;-Dakka.log-config-on-start=on&quot;), // prints out akka config
            // Test / javaOptions ++= Seq(&quot;-Dconfig.trace=loads&quot;), // prints out config locations
            Test / testOptions += Tests.Argument(&quot;-oDF&quot;), // show full stack traces and test case durations

            IntegrationTest / javaOptions := Seq(&quot;-Dconfig.resource=graphdb-se.conf&quot;) ++ webapiJavaTestOptions,
            IntegrationTest / testOptions += Tests.Argument(&quot;-oDF&quot;), // show full stack traces and test case durations

            Gatling / javaOptions := Seq(&quot;-Dconfig.resource=graphdb-se.conf&quot;) ++ webapiJavaTestOptions,
            Gatling / testOptions := Seq(),
            GatlingIt / javaOptions := Seq(&quot;-Dconfig.resource=graphdb-se.conf&quot;) ++ webapiJavaTestOptions,
            GatlingIt / testOptions := Seq(),

            GDBSE / javaOptions := Seq(&quot;-Dconfig.resource=graphdb-se.conf&quot;) ++ webapiJavaTestOptions,
            GDBSEIt / javaOptions := Seq(&quot;-Dconfig.resource=graphdb-se.conf&quot;) ++ webapiJavaTestOptions,

            GDBFree / javaOptions := Seq(&quot;-Dconfig.resource=graphdb-free.conf&quot;) ++ webapiJavaTestOptions,
            GDBFreeIt / javaOptions := Seq(&quot;-Dconfig.resource=graphdb-free.conf&quot;) ++ webapiJavaTestOptions,

            FusekiTest / javaOptions := Seq(&quot;-Dconfig.resource=fuseki.conf&quot;) ++ webapiJavaTestOptions,
            FusekiIt / javaOptions := Seq(&quot;-Dconfig.resource=fuseki.conf&quot;) ++ webapiJavaTestOptions,

            EmbeddedJenaTDBTest / javaOptions := Seq(&quot;-Dconfig.resource=jenatdb.conf&quot;) ++ webapiJavaTestOptions

            // enable publishing the jars for test and it
            // Test / packageBin / publishArtifact := true,
            // IntegrationTest / packageBin / publishArtifact := true,
            // addArtifact(artifact in (IntegrationTest, packageBin), packageBin in IntegrationTest)
        )
        .settings(
            // prepare for publishing

            // Skip packageDoc and packageSrc task on stage
            Compile / packageDoc / mappings := Seq(),
            Compile / packageSrc / mappings := Seq(),

            Universal / mappings ++= {
                // copy the scripts folder
                directory(&quot;webapi/scripts&quot;) ++
                  // add knora-ontologies
                  directory(&quot;knora-ontologies&quot;) ++
                  // add test-data directory
                  directory(&quot;webapi/_test_data&quot;) ++
                  // copy the configuration files to config directory
                  contentOf(&quot;webapi/configs&quot;).toMap.mapValues(&quot;config/&quot; + _) ++
                  // copy configuration files to config directory
                  contentOf(&quot;webapi/src/main/resources&quot;).toMap.mapValues(&quot;config/&quot; + _)
            },

            // add &#39;config&#39; directory to the classpath of the start script,
            Universal / scriptClasspath := Seq(&quot;../config/&quot;) ++ scriptClasspath.value,

            // need this here, so that the Manifest inside the jars has the correct main class set.
            Compile / mainClass := Some(&quot;org.knora.webapi.Main&quot;),
            Compile / run / mainClass := Some(&quot;org.knora.webapi.Main&quot;),

            // add dockerCommands used to create the image
            // docker:stage, docker:publishLocal, docker:publish, docker:clean

            dockerRepository := Some(&quot;dhlabbasel&quot;),

            maintainer := &quot;400790+subotic@users.noreply.github.com&quot;,

            Docker / dockerExposedPorts ++= Seq(3333, 10001),
            Docker / dockerCommands := Seq(
                Cmd(&quot;FROM&quot;, &quot;adoptopenjdk/openjdk11:alpine-jre&quot;),
                Cmd(&quot;LABEL&quot;, s&quot;&quot;&quot;MAINTAINER=&quot;${maintainer.value}&quot;&quot;&quot;&quot;),

                Cmd(&quot;RUN apk update &amp;&amp; apk upgrade &amp;&amp; apk add bash&quot;),

                Cmd(&quot;COPY&quot;, &quot;opt/docker&quot;, &quot;/webapi&quot;),
                Cmd(&quot;WORKDIR&quot;, &quot;/webapi&quot;),

                Cmd(&quot;EXPOSE&quot;, &quot;3333&quot;),

                ExecCmd(&quot;ENTRYPOINT&quot;, &quot;bin/webapi&quot;),
            )

        )
        .settings(
            buildInfoKeys ++= Seq[BuildInfoKey](
                name,
                version,
                &quot;akkaHttp&quot; -&gt; Dependencies.akkaHttpVersion.value
            ),
            buildInfoPackage := &quot;org.knora.webapi&quot;
        )

lazy val webapiJavaRunOptions = Seq(
    // &quot;-showversion&quot;,
    &quot;-Xms1G&quot;,
    &quot;-Xmx1G&quot;,
    // &quot;-verbose:gc&quot;,
    //&quot;-XX:+UseG1GC&quot;,
    //&quot;-XX:MaxGCPauseMillis=500&quot;
    &quot;-Dcom.sun.management.jmxremote&quot;,
    // &quot;-Dcom.sun.management.jmxremote.port=1617&quot;,
    &quot;-Dcom.sun.management.jmxremote.authenticate=false&quot;,
    &quot;-Dcom.sun.management.jmxremote.ssl=false&quot;,
    //&quot;-agentpath:/Applications/YourKit-Java-Profiler-2018.04.app/Contents/Resources/bin/mac/libyjpagent.jnilib&quot;
)

lazy val webapiJavaTestOptions = Seq(
    // &quot;-showversion&quot;,
    &quot;-Xms1G&quot;,
    &quot;-Xmx1G&quot;
    // &quot;-verbose:gc&quot;,
    //&quot;-XX:+UseG1GC&quot;,
    //&quot;-XX:MaxGCPauseMillis=500&quot;,
    //&quot;-XX:MaxMetaspaceSize=4096m&quot;
)

// packaging for running normal tests (usage: webapi_test/stage)
lazy val webapi_test = project
  // we put the results  in a build folder
  .in(file(&quot;webapi/build/test&quot;))
  .enablePlugins(JavaAppPackaging)
  .settings(
      Dependencies.webapiTestAndITLibraryDependencies,
      // Skip packageDoc and packageSrc task on stage
      Compile / packageDoc / mappings := Seq(),
      Compile / packageSrc / mappings := Seq(),
      publishArtifact in (Test, packageBin) := true,
      Compile / mainClass := Some(&quot;org.scalatest.tools.Runner&quot;),
      // adds the test jar to mappings
      mappings in Universal ++= {
          // generates the test package
          val testjar = (packageBin in Test).value
          // maps this file to your lib folder in your output package
          testjar -&gt; s&quot;lib/${testjar.getName}&quot;
          // copy the scripts folder
          directory(&quot;webapi/scripts&quot;) ++
            // add knora-ontologies
            directory(&quot;knora-ontologies&quot;) ++
            // add test-data directory
            directory(&quot;webapi/_test_data&quot;) ++
            // copy the configuration files to config directory
            contentOf(&quot;webapi/configs&quot;).toMap.mapValues(&quot;config/&quot; + _) ++
            // copy configuration files to config directory
            contentOf(&quot;webapi/src/main/resources&quot;).toMap.mapValues(&quot;config/&quot; + _)
      },
      scriptClasspath += (packageBin in Test).value.getName
  )
  .dependsOn(webapi)

// packaging for running IT tests (usage: webapi_it/stage)
lazy val webapi_it = project
  // we put the results in a build folder
  .in(file(&quot;webapi/build/it&quot;))
  .enablePlugins(JavaAppPackaging)
  .configs(
      IntegrationTest
  )
  .settings(
      inConfig(IntegrationTest)(Defaults.testSettings),
  )
  .settings(
      Dependencies.webapiTestAndITLibraryDependencies,
      // Skip packageDoc and packageSrc task on stage
      Compile / packageDoc / mappings := Seq(),
      Compile / packageSrc / mappings := Seq(),
      IntegrationTest / packageBin / publishArtifact := true,
      addArtifact(artifact in (IntegrationTest, packageBin), packageBin in IntegrationTest),
      Compile / mainClass := Some(&quot;org.scalatest.run&quot;),
      // adds the test jar to mappings
      mappings in Universal += {
          // generates the test package
          val testjar = (packageBin in IntegrationTest).value
          // maps this file to your lib folder in your output package
          testjar -&gt; s&quot;lib/${testjar.getName}&quot;
      },
      scriptClasspath += (packageBin in Test).value.getName
  )
  .dependsOn(webapi)

def knoraModule(name: String): Project =
    Project(id = name, base = file(name))
      .settings(buildSettings)</code></pre>
<h2><a href="#building-deployment-packages" name="building-deployment-packages" class="anchor"><span class="anchor-link"></span></a>Building Deployment Packages</h2>
<p>Deployment packages for <code>salsah1</code> and <code>webapi</code> can be built by using the following SBT tasks:</p>
<ul>
  <li><code>$ sbt stage</code> - Stages the app so that it can be run locally without having the app packaged.</li>
  <li><code>$ sbt universal:packageBin</code> - Generates a universal zip file</li>
  <li><code>$ sbt universal:packageZipTarball</code> - Generates a universal tgz file</li>
</ul>
<p>The tasks can be scoped by prefixing <code>salsah1/</code> or <code>webapi/</code>, e.g., to only run <code>sbt stage</code> for the <code>webapi</code> project, run:</p>
<pre class="prettyprint"><code class="language-bash">$ sbt webapi/stage
</code></pre>
<h2><a href="#building-docker-images" name="building-docker-images" class="anchor"><span class="anchor-link"></span></a>Building Docker Images</h2>
<p>Docker images for <code>salsah1</code> and <code>webapi</code> can be built by using the following SBT tasks:</p>
<ul>
  <li><code>$ sbt docker:stage</code> - Generates a directory with the Dockerfile and environment prepared for creating a Docker image.</li>
  <li><code>$ sbt docker:publishLocal</code> - Builds an image using the local Docker server.</li>
  <li><code>$ sbt docker:publish</code> - Builds an image using the local Docker server, and pushes it to the configured remote repository.</li>
  <li><code>$ sbt docker:clean</code> - Removes the built image from the local Docker server.</li>
</ul>
<p>The tasks can be scoped by prefixing <code>salsah1/</code> or <code>webapi/</code>, e.g., to only run <code>sbt docker:stage</code> for the <code>webapi</code> project, run:</p>
<pre class="prettyprint"><code class="language-bash">$ sbt webapi/docker:stage
</code></pre>
<h2><a href="#running-the-knora-stack-graphdb-webapi-salsah1-sipi-" name="running-the-knora-stack-graphdb-webapi-salsah1-sipi-" class="anchor"><span class="anchor-link"></span></a>Running the Knora Stack (graphdb, webapi, salsah1, sipi)</h2>
<p>The complete knora stack (graphdb, webapi, salsah1, sipi) can be started by invoking the following SBT task:</p>
<pre class="prettyprint"><code class="language-bash">$ sbt dockerComposeUp
</code></pre>
<p>This will build, publish locally and use the docker images for <code>webapi</code> and <code>salsah1</code>. The versions defined in <code>project/Dependencies</code> will be used for <code>GraphDB</code> and <code>Sipi</code>.</p>
<p>The following SBT tasks are available:</p>
<ul>
  <li><code>$ sbt dockerComposeUp</code> - starts the whole stack and prints out a summary</li>
  <li><code>$ sbt dockerComposeRestart</code> - stops and the starts again the whole stack</li>
  <li><code>$ sbt dockerComposeStop</code> - stops the whole stack</li>
</ul>
<p>Running the whole Knora stack requires some configuration, which can be done through environment variables. These can be set in the shell before running <code>sbt</code>:</p>
<ul>
  <li><code>KNORA_GDB_TYPE</code> - the type of GraphDB (SE or FREE). Possible values are <code>graphdb-se</code> or <code>graphdb-free</code>.  The default value is <code>graphdb-se</code>.</li>
  <li><code>KNORA_GDB_HOME</code> - the path to folder where the GraphDB data will be stored. Default is <code>GITREPOROOT/triplestores/graphdb/home</code>.</li>
  <li><code>KNORA_GDB_LICENSE</code> - the path to the GraphDB-SE license. Default is <code>GITREPOROOT/triplestores/graphdb/graphdb.license</code>.</li>
</ul>
<h2><a href="#building-documentation" name="building-documentation" class="anchor"><span class="anchor-link"></span></a>Building Documentation</h2>
<p>There are some prerequisites described in the <a href="https://github.com/dhlab-basel/Knora/blob/develop/docs/Readme.md">docs/Readme.md</a>.</p>
<p>The complete Knora documentation site is built by invoking the following tasks:</p>
<ul>
  <li><code>$ sbt docs/makeSite</code> - generates the documentation which can be found under <code>docs/target/site/</code></li>
  <li><code>$ sbt docs/previewSite</code> - previews the generated site by launching a static web server</li>
  <li><code>$ sbt docs/previewAuto</code> - previews the generated site by launching a dynamic server updating its content at each modification in your source files.</li>
</ul>
<p>Both preview tasks launch the server on port <code>4000</code> and attempt to connect your browser to <code>http://localhost:4000/</code>.</p>
<h2><a href="#publishing-documentation" name="publishing-documentation" class="anchor"><span class="anchor-link"></span></a>Publishing Documentation</h2>
<p>To publish the documentation, you need to be on the <code>develop</code> branch and then execute the following task:</p>
<pre class="prettyprint"><code class="language-bash">$ sbt docs/ghpagesPushSite
</code></pre>
<p>This task will build all documentation and publish it to the <code>gh-pages</code> branch.</p>
</div>
<div>
<a href="https://github.com/dhlab-basel/Knora/tree/master/docs/src/paradox/05-internals/development/build-process.md" title="Edit this page" class="md-source-file md-edit">
Edit this page
</a>
</div>
<div class="print-only">
<span class="md-source-file md-version">
10.0.0
</span>
</div>
</article>
</div>
</div>
</main>
<footer class="md-footer">
<div class="md-footer-nav">
<nav class="md-footer-nav__inner md-grid">
<a href="../../05-internals/development/building-and-running.html" title="Building and Running" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
<div class="md-flex__cell md-flex__cell--shrink">
<i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
</div>
<div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
<span class="md-flex__ellipsis">
<span class="md-footer-nav__direction">
Previous
</span>
Building and Running
</span>
</div>
</a>
<a href="../../05-internals/development/intellij-config.html" title="Setup IntelliJ for development of Knora" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
<div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
<span class="md-flex__ellipsis">
<span class="md-footer-nav__direction">
Next
</span>
Setup IntelliJ for development of Knora
</span>
</div>
<div class="md-flex__cell md-flex__cell--shrink">
<i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
</div>
</a>
</nav>
</div>
<div class="md-footer-meta md-typeset">
<div class="md-footer-meta__inner md-grid">
<div class="md-footer-copyright">
<div class="md-footer-copyright__highlight">
Copyright 2015-2019 the contributors (see Contributors.md)
</div>
Powered by
<a href="https://github.com/lightbend/paradox">Paradox</a>
and
<a href="https://jonas.github.io/paradox-material-theme/">Paradox Material Theme</a>

</div>
<div class="md-footer-social">
<a href="https://github.com/dhlab-basel" class="md-footer-social__link fa fa-github"></a><a href="https://twitter.com/dhlabbasel" class="md-footer-social__link fa fa-twitter"></a>
</div>

</div>
</div>
</footer>

</div>
<script src="../../assets/javascripts/application.5165553b.js"></script>
<script src="../../assets/javascripts/paradox-material-theme.js"></script>
<script>app.initialize({version:"0.17",url:{base:"../../."}})</script>
<script type="text/javascript" src="../../lib/prettify/prettify.js"></script>
<script type="text/javascript" src="../../lib/prettify/lang-scala.js"></script>
<script type="text/javascript">
document.addEventListener("DOMContentLoaded", function(event) {
window.prettyPrint && prettyPrint();
});
</script>
</body>
</html>
